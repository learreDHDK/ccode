<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--script src="https://code.highcharts.com/maps/highmaps.js"></script>
  <script src="https://code.highcharts.com/maps/modules/data.js"></script>
  <script src="https://code.highcharts.com/maps/modules/exporting.js"></script>
  <script src="https://code.highcharts.com/maps/modules/offline-exporting.js"></script>
  <script src="https://code.highcharts.com/mapdata/custom/world.js"></script-->

  <!-- Flag sprites service provided by Martijn Lafeber, https://github.com/lafeber/world-flags-sprite/blob/master/LICENSE -->
  <link rel="stylesheet" type="text/css" href="//github.com/downloads/lafeber/world-flags-sprite/flags32.css" />

  <title>CCode</title>

  <!-- Bootstrap core CSS -->
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom fonts for this template -->
  <link href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:500,700" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Muli:400,400i,800,800i" rel="stylesheet">
  <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="css/resume.css" rel="stylesheet">

</head>

<body id="page-top">

  <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top" id="sideNav">
    <a class="navbar-brand js-scroll-trigger" href="#page-top">
      <span class="d-block d-lg-none">CCode</span>
      <span class="d-none d-lg-block">
        <img class="img-fluid img-profile" src="img/damaged1.png" alt="">
      </span>
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link js-scroll-trigger" href="#about">Visualization</a>
        </li>
        <li class="nav-item">
          <a class="nav-link js-scroll-trigger" href="#experience">Metadata</a>
        </li>
        <li class="nav-item">
          <a class="nav-link js-scroll-trigger" href="#education">Documentation</a>
        </li>
        <li>
        	<div class="social-icons">
        		<a href="https://github.com/learreDHDK/ccode">
            		<i class="fab fa-github"></i>
          		</a>
        	</div>
        </li>
      </ul>
    </div>
  </nav>

  <div class="container-fluid p-0">

    <section class="resume-section p-3 p-lg-5 d-flex align-items-center" id="about">
      <div class="w-100">
        <h1 style="color: #216140;" class="mb-0">CC
          <span class="text-primary">ode</span>
        </h1>
        <div class="subheading mb-5">Climate Change Open Data Experiment
        </div>
        <p class="lead mb-5"></p>
        <div id="container" style="position: relative;"></div> <!--mappa-->
        <div class="slidecontainer">
          <p>Select year:</p>
          <input id="sliderYear" type="range" min="1980" max="2019" value="2019">
          <div id="divYear">2019</div>
        </div>
        <p>Click <a href="visualization.html">here</a> to see the visualizations</p>
      </div>
    </section>

    <hr class="m-0">

    <section class="resume-section p-3 p-lg-5 d-flex justify-content-center" id="experience">
      <div class="w-100">
        <h2 class="mb-5">Metadata</h2>

        <div class="resume-item d-flex flex-column flex-md-row justify-content-between mb-5">
          <div class="resume-content">
            <h3 class="mb-0">Senior Web Developer</h3>
            <div class="subheading mb-3">Intelitec Solutions</div>
            <p>Bring to the table win-win survival strategies to ensure proactive domination. At the end of the day, going forward, a new normal that has evolved from generation X is on the runway heading towards a streamlined cloud solution. User generated content in real-time will have multiple touchpoints for offshoring.</p>
          </div>
          <div class="resume-date text-md-right">
            <span class="text-primary">March 2013 - Present</span>
          </div>
        </div>
      </div>

    </section>

    <hr class="m-0">

    <section class="resume-section p-3 p-lg-5 d-flex align-items-center" id="education">
      <div class="w-100">
        <h2 class="mb-5">Documentation</h2>

        <div class="resume-item d-flex flex-column flex-md-row justify-content-between mb-5">
          <p>Click here to see the <a href="https://github.com/learreDHDK/ccode/blob/master/README.md">documentation</a> on the GitHub page</p>
          <!--<div class="resume-content">
            <h3 class="mb-0">University of Colorado Boulder</h3>
            <div class="subheading mb-3">Bachelor of Science</div>
            <div>Computer Science - Web Development Track</div>
            <p>GPA: 3.23</p>
          </div>
          <div class="resume-date text-md-right">
            <span class="text-primary">August 2006 - May 2010</span>
          </div>-->
        </div>
      </div>
    </section>

  </div>

  <!-- Bootstrap core JavaScript -->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Plugin JavaScript -->
  <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

  <!-- Custom scripts for this template -->
  <script src="js/resume.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.3/d3.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.9/topojson.min.js"></script>
  <script src="js/datamaps.world.min.js"></script>
  <script>

     // import del json con i dati per i colori della mappa
    var request = new XMLHttpRequest();
    request.open("GET", "nat-events-percent.json", false);
    request.send(null)
    var stats = JSON.parse(request.responseText);
    
    // import del json con i dati da mettere nel tooltip
    var request = new XMLHttpRequest();
    request.open("GET", "nat-events-total.json", false);
    request.send(null)
    var tooltip_info = JSON.parse(request.responseText);

    var slider = document.getElementById('sliderYear'), divYear = document.getElementById("divYear");
    var minYear = Math.min(...Object.keys(stats).map(y => parseInt(y)));
    var maxYear = Math.max(...Object.keys(stats).map(y => parseInt(y)));

    var year = maxYear;
    var lastPaintedYear = null;
    console.log(year);


    slider.oninput = slider.onchange = function() {
        divYear.innerHTML = this.value; // + " - " + (parseInt(this.value)+4);
        //divYear.innerHTML = this.value + " - " + (parseInt(this.value)+4);
        year = this.value;
        refreshMap(this.value);
    }

    var hue = 169;         // from 0 to 255
    var saturation = 61;   // in %
    var minLightness = 10; // in %
    var maxLightness = 90; // in %
    var lightnessAmplitude = maxLightness - minLightness;

    var minValue = 0;
    var maxValue = 137; //somma massima delle percentuali
    var valuesAmplitude = maxValue - minValue;

    var map = new Datamap({
      element: document.getElementById("container"),
      projection: 'mercator', // equirectangular
      //fills: {defaultFill: "hsl(169, 61, " + minLightness + ")"},
      fills: {defaultFill: "#000"},
      data: {},
      geographyConfig: {
          //highlightBorderColor: '#bada55',
        popupTemplate: function(geography, data) {
            if(data.info == undefined)
              data.info = "";
            return '<div class="hoverinfo"><b>' + geography.properties.name + "</b>" + data.info +"</div>" //info nel tooltip
          },
          //highlightBorderWidth: 3
        },
    });

    function refreshMap(year){
      if(lastPaintedYear == year)
        return;
      lastPaintedYear = year;

      let totals = {};
      let stats_year = stats[year]
      for(let alpha3 in stats_year){
        let tot = 0;
        let info = "";
        let stats_year_alpha3 = stats_year[alpha3];
        for(let stat in stats_year_alpha3){
          let value = stats_year_alpha3[stat];
          tot += value;  // 4 / value * 100
          info += "<br>" + stat + ": " + value; //tot
        }

        let light = (1 - (tot - minValue) / valuesAmplitude) * lightnessAmplitude + minLightness;
        light = Math.floor(light);
        light = Math.max(Math.min(light, maxLightness), minLightness);
        //totals[alpha3] = "hsl(169, 61, " + light + ")";
        totals[alpha3] = {color: "hsl(169, 61, " + light + ")", info: info};
      }
      
      map.updateChoropleth(totals, {reset: true});
    }

    refreshMap(year);


  </script>

</body>

</html>
